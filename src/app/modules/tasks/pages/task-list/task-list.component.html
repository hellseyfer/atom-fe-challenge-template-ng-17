<div class="task-container">
  <header class="task-header">
    <h1>Lista de Tareas</h1>
    <div class="user-info">
      <span>Bienvenido, {{ user?.email || 'Usuario' }}</span>
      <button (click)="logout()" class="btn btn-logout">Cerrar Sesión</button>
    </div>
  </header>

  <div *ngIf="error" class="error-message">
    {{ error }}
    <button (click)="error = null" class="btn-close">&times;</button>
  </div>

  <div class="add-task">
    <div class="form-group">
      <input
        type="text"
        [(ngModel)]="newTaskTitle"
        (keyup.enter)="addTask()"
        placeholder="Título de la tarea"
        class="task-input"
        [disabled]="isLoading"
      />
    </div>
    <div class="form-group">
      <textarea
        [(ngModel)]="newTaskDescription"
        (keyup.enter)="$event.preventDefault(); addTask()"
        placeholder="Descripción (opcional)"
        class="task-input task-description-input"
        [disabled]="isLoading"
      ></textarea>
    </div>
    <button 
      (click)="addTask()" 
      class="btn btn-add" 
      [disabled]="!newTaskTitle.trim() || isLoading"
    >
      {{ isLoading ? 'Añadiendo...' : 'Agregar Tarea' }}
    </button>
  </div>

  <div *ngIf="isLoading && tasks.length === 0" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando tareas...</p>
  </div>

  <ul class="task-list" *ngIf="!isLoading || tasks.length > 0">
    <li *ngFor="let task of tasks" class="task-item" [class.completed]="task.completed">
      <div class="task-content">
        <div class="task-checkbox-container">
          <input
            type="checkbox"
            [id]="'task-' + task.id"
            [checked]="task.completed"
            (change)="toggleTaskCompletion(task)"
            class="task-checkbox"
          />
          <label [for]="'task-' + task.id" class="task-checkbox-label"></label>
        </div>
        
        <div class="task-details">
          <div class="task-header">
            <h3 class="task-title">{{ task.title }}</h3>
            <div class="task-date">
              <i class="fas fa-calendar"></i>
              {{ task.createdAt | date:'mediumDate' }}
              <span class="task-time">{{ task.createdAt | date:'shortTime' }}</span>
            </div>
          </div>
          
          <p class="task-description" *ngIf="task.description">
            {{ task.description }}
          </p>
          
          <div class="task-status" [class.completed]="task.completed">
            {{ task.completed ? 'Completada' : 'Pendiente' }}
          </div>
        </div>
      </div>
      
      <div class="task-actions">
        <button (click)="deleteTask(task.id)" class="btn btn-icon" title="Eliminar tarea">
          <img src="assets/icons/x.png" alt="Eliminar" class="delete-icon">
        </button>
      </div>
    </li>
  </ul>

  <div *ngIf="tasks.length === 0 && !isLoading" class="empty-state">
    No hay tareas pendientes. ¡Agrega una nueva tarea para comenzar!
  </div>
</div>
